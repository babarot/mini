{{- $url := (.Get 0) -}}
{{- with $result := resources.GetRemote $url -}}
    {{- with $result.Err -}}
        {{- warnf "Error fetching URL: %s" . -}}{{- . -}}
    {{- else -}}
        {{- $title := "" -}}
        {{- $description := "" -}}
        {{- $image := "" -}}

        {{- with $findHead := index (findRE "(?s)<head>.*?</head>" $result.Content) 0 -}}
            {{- range $meta := findRE "<meta[^>]+>" $findHead -}}
                {{- $name := replaceRE ".*name=[\"'](.*?)[\"'].*" "$1" $meta -}}
                {{- $property := replaceRE ".*property=[\"'](.*?)[\"'].*" "$1" $meta -}}
                {{- $content := replaceRE ".*content=[\"'](.*?)[\"'].*" "$1" $meta -}}
                
                {{- if eq $property "og:title" -}}
                    {{- $title = $content -}}
                {{- else if eq $property "og:description" -}}
                    {{- $description = $content -}}
                {{- else if eq $property "og:image" -}}
                    {{- $image = $content -}}
                {{- end -}}

                {{- if and (eq $description "") (eq $name "description") -}}
                    {{- $description = $content -}}
                {{- end -}}
            {{- end -}}
        {{- end -}}

        {{- if eq $title "" -}}
            {{- with index (findRE "<title>(.*?)</title>" $result.Content) 0 -}}
                {{- $title = replaceRE "<title>(.*?)</title>" "$1" . -}}
            {{- end -}}
        {{- end -}}

        {{- if eq $image "" -}}
            {{- $image = $.Site.Params.defaultNoimage -}}
        {{- end -}}

        <a href="{{- $url -}}" class="hugo-zenn-blogcard" target="_blank" rel="noopener noreferrer">
            <div class="hugo-zenn-blogcard__image">
                <img src="{{- $image -}}" alt="Thumbnail" loading="lazy">
            </div>
            <div class="hugo-zenn-blogcard__content">
                <div class="hugo-zenn-blogcard__title">{{- $title -}}</div>
                <p class="hugo-zenn-blogcard__description">{{- $description | plainify | safeHTML -}}</p>
                <div class="hugo-zenn-blogcard__domain">{{- $url | replaceRE "^https?://([^/]+).*" "$1" -}}</div>
            </div>
        </a>

        <style>
        :root {
            --hugo-zenn-blogcard-bg: #ffffff;
            --hugo-zenn-blogcard-border: #e2e8f0;
            --hugo-zenn-blogcard-text-primary: #1a202c;
            --hugo-zenn-blogcard-text-secondary: #4a5568;
            --hugo-zenn-blogcard-text-domain: #718096;
            --hugo-zenn-blogcard-image-bg: #e2e8f0;
            --hugo-zenn-blogcard-hover-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --hugo-zenn-blogcard-bg: #24283B; /* #2C2C3E, #2D3748, #273244, #1E2633 */
                --hugo-zenn-blogcard-border: #2D3748;
                --hugo-zenn-blogcard-text-primary: rgb(255, 255, 255);
                --hugo-zenn-blogcard-text-secondary: rgb(220, 220, 220);
                --hugo-zenn-blogcard-text-domain: rgb(180, 180, 180);
                --hugo-zenn-blogcard-image-bg: #22222E;
                --hugo-zenn-blogcard-hover-shadow: 0 4px 6px -1px rgba(255, 255, 255, 0.1), 0 2px 4px -1px rgba(255, 255, 255, 0.06);
            }
        }

        .hugo-zenn-blogcard {
            display: flex !important;
            align-items: center !important;
            padding: 16px !important;
            border: 1px solid var(--hugo-zenn-blogcard-border) !important;
            border-radius: 8px !important;
            background: var(--hugo-zenn-blogcard-bg) !important;
            text-decoration: none !important;
            color: var(--hugo-zenn-blogcard-text-primary) !important;
            transition: box-shadow 0.3s ease !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        .hugo-zenn-blogcard:hover {
            box-shadow: var(--hugo-zenn-blogcard-hover-shadow) !important;
        }
        .hugo-zenn-blogcard__image {
            flex-shrink: 0 !important;
            width: 80px !important;
            height: 80px !important;
            overflow: hidden !important;
            border-radius: 6px !important;
            background: var(--hugo-zenn-blogcard-image-bg) !important;
            margin-right: 16px !important;
        }
        .hugo-zenn-blogcard__image img {
            width: 100% !important;
            height: 100% !important;
            object-fit: cover !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        .hugo-zenn-blogcard__content {
            flex-grow: 1 !important;
            min-width: 0 !important;
        }
        .hugo-zenn-blogcard__title {
            margin: 0 0 8px 0 !important;
            font-size: 16px !important;
            font-weight: bold !important;
            color: var(--hugo-zenn-blogcard-text-primary) !important;
            display: -webkit-box !important;
            -webkit-box-orient: vertical !important;
            -webkit-line-clamp: 2 !important;
            overflow: hidden !important;
            line-height: 1.4 !important;
        }
        .hugo-zenn-blogcard__description {
            margin: 0 0 8px 0 !important;
            font-size: 14px !important;
            color: var(--hugo-zenn-blogcard-text-secondary) !important;
            display: -webkit-box !important;
            -webkit-box-orient: vertical !important;
            -webkit-line-clamp: 2 !important;
            overflow: hidden !important;
            line-height: 1.4 !important;
        }
        .hugo-zenn-blogcard__domain {
            font-size: 12px !important;
            color: var(--hugo-zenn-blogcard-text-domain) !important;
        }
        </style>
    {{- end -}}
{{- end -}}
